set shell := ["bash", "-lc"]
set dotenv-load := true

# Development Commands
chat:
	uv run chainlit run explore/chatlit_app.py -w --port 8001

mcp:
	npx -y mcp-picnic

dev-backend:
	@echo "ğŸš€ Starting backend in development mode..."
	cd server && uv run uvicorn main:app --reload --port 8000

dev-frontend:
	@echo "ğŸš€ Starting frontend in development mode..."
	cd app && npm run dev

local-dev:
	@echo "ğŸš€ Starting full local development stack..."
	@echo "Backend: http://localhost:8000"
	@echo "Frontend: http://localhost:5173"
	@echo "Features: MCP Picnic integration enabled"
	@echo ""
	just dev-backend & just dev-frontend

# Production Build Commands
build-frontend:
	@echo "ğŸ“¦ Building frontend for production..."
	cd app && npm run build

preview-frontend:
	@echo "ğŸ‘€ Previewing production frontend build..."
	cd app && npm run preview

# Hosting Commands
host-backend:
	@echo "ğŸŒ Starting backend for production hosting..."
	@echo "Make sure ENVIRONMENT=production in server/.env"
	@echo "MCP integration will be disabled"
	cd server && uv run uvicorn main:app --host 0.0.0.0 --port 8000

host-frontend:
	@echo "ğŸŒ Serving frontend for production hosting..."
	@echo "Make sure VITE_API_BASE_URL points to production API"
	just build-frontend
	cd app && npm run preview -- --host 0.0.0.0 --port 5173

# Development Setup
install:
	@echo "ğŸ“¥ Installing dependencies..."
	@echo "Installing server dependencies..."
	cd server && uv sync
	@echo "Installing frontend dependencies..."
	cd app && npm install

setup-env:
	@echo "âš™ï¸  Setting up environment files..."
	@if [ ! -f server/.env ]; then cp server/.env.example server/.env && echo "Created server/.env - please configure"; fi
	@if [ ! -f app/.env ]; then cp app/.env.example app/.env && echo "Created app/.env - please configure"; fi

# Utility Commands
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	cd app && rm -rf dist node_modules/.vite
	cd server && rm -rf __pycache__ .pytest_cache

help:
	@echo "ğŸ“‹ Available commands:"
	@echo ""
	@echo "Development:"
	@echo "  just local-dev      - Start full development stack (backend + frontend)"
	@echo "  just dev-backend    - Start backend only (port 8000)"
	@echo "  just dev-frontend   - Start frontend only (port 5173)"
	@echo "  just chat           - Start Chainlit chat interface"
	@echo "  just mcp            - Start MCP Picnic server manually"
	@echo ""
	@echo "Production:"
	@echo "  just build-frontend - Build frontend for production"
	@echo "  just host-backend   - Start backend for production hosting"
	@echo "  just host-frontend  - Start frontend for production hosting"
	@echo ""
	@echo "Setup:"
	@echo "  just install        - Install all dependencies"
	@echo "  just setup-env      - Create .env files from examples"
	@echo "  just clean          - Clean build artifacts"

